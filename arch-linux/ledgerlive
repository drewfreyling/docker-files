# DO NOT MODIFY THIS AUTOGENERATED FILE
# Change it in m4 folder
FROM sandrokeil/archlinux:latest
COPY arch-aur-install /usr/bin
RUN echo "[multilib]" >> /etc/pacman.conf \
    && echo "Include = /etc/pacman.d/mirrorlist" >> /etc/pacman.conf \
    && pacman -Sl multilib \
    && pacman -Sy --noconfirm xdg-utils libxss lib32-gconf lib32-nss
RUN pacman -Sy --needed --noconfirm sudo patch \
    && useradd builduser -m \
    && passwd -d builduser \
    && printf 'builduser ALL=(ALL) ALL\n' | tee -a /etc/sudoers \
    && sudo -u builduser bash -c 'cd ~ && mkdir tmp && cd tmp && arch-aur-install https://aur.archlinux.org/cgit/aur.git/snapshot/ledger-live-bin.tar.gz' \
    && userdel -r builduser \
    && pacman -Scc --noconfirm \
    && echo 'SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="1b7c", MODE="0660", GROUP="users",  TAG+="uaccess", TAG+="udev-acl"' > /etc/udev/rules.d/20-hw1.rules \
    && echo 'SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="2b7c", MODE="0660", GROUP="users", TAG+="uaccess", TAG+="udev-acl"' >> /etc/udev/rules.d/20-hw1.rules \
    && echo 'SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="3b7c", MODE="0660", GROUP="users", TAG+="uaccess", TAG+="udev-acl"' >> /etc/udev/rules.d/20-hw1.rules \
    && echo 'SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="4b7c", MODE="0660", GROUP="users", TAG+="uaccess", TAG+="udev-acl"' >> /etc/udev/rules.d/20-hw1.rules \
    && echo 'SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="1807", MODE="0660", GROUP="users", TAG+="uaccess", TAG+="udev-acl"' >> /etc/udev/rules.d/20-hw1.rules \
    && echo 'SUBSYSTEMS=="usb", ATTRS{idVendor}=="2581", ATTRS{idProduct}=="1808", MODE="0660", GROUP="users", TAG+="uaccess", TAG+="udev-acl"' >> /etc/udev/rules.d/20-hw1.rules \
    && echo 'SUBSYSTEMS=="usb", ATTRS{idVendor}=="2c97", ATTRS{idProduct}=="0000", MODE="0660", GROUP="users", TAG+="uaccess", TAG+="udev-acl"' >> /etc/udev/rules.d/20-hw1.rules \
    && echo 'SUBSYSTEMS=="usb", ATTRS{idVendor}=="2c97", ATTRS{idProduct}=="0001", MODE="0660", GROUP="users", TAG+="uaccess", TAG+="udev-acl”' >> /etc/udev/rules.d/20-hw1.rules \
    && echo 'KERNEL=="hidraw*", SUBSYSTEM=="hidraw", MODE="0660", GROUP="users", ATTRS{idVendor}=="2c97"' >> /etc/udev/rules.d/20-hw1.rules \
    && echo 'KERNEL=="hidraw*", SUBSYSTEM=="hidraw", MODE="0660", GROUP="users", ATTRS{idVendor}=="2581"' >> /etc/udev/rules.d/20-hw1.rules
ENTRYPOINT ["ledger-live-desktop"]
